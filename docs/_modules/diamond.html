<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-3.1.2, furo 2021.04.11.beta34"/>
        <title>diamond - Hodge diamond cutter v1.0 documentation</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Hodge diamond cutter v1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Hodge diamond cutter v1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <h1>Source code for diamond</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">"""</span>
<span class="sd">A tool to work with Hodge diamonds, comes with many varieties and constructions</span>
<span class="sd">built into it.</span>

<span class="sd">Hodge diamonds encode the Hodge numbers of a variety, and provide interesting</span>
<span class="sd">information about its structure. They provide a numerical incarnation of many</span>
<span class="sd">operations one can perform in algebraic geometry, such as blowups, projective</span>
<span class="sd">bundles, products. They are also computed for many more specific constructions</span>
<span class="sd">such as certain moduli spaces of sheaves, or flag varieties, ...</span>

<span class="sd">These Hodge numbers are defined as the dimensions of the sheaf cohomology of</span>
<span class="sd">exterior powers of the cotangent bundle, i.e.</span>

<span class="sd">.. MATH::</span>

<span class="sd">    \mathrm{h}^{p,q}(X)=\dim\mathrm{H}^q(X,\Omega_X^p)</span>

<span class="sd">Here $p$ and $q$ range from $0$ to $n=\\dim X$. These numbers satisfy additional</span>
<span class="sd">symmetry properties:</span>

<span class="sd">    * Hodge symmetry: $\\mathrm{h}^{p,q}(X)=\\mathrm{h}^{q,p}(X)$</span>
<span class="sd">    * Serre duality: $\\mathrm{h}^{p,q}(X)=\\mathrm{h}^{n-p,n-q}(X)$</span>

<span class="sd">Because of these symmetries they are usually displayed as a diamond (it's</span>
<span class="sd">really just a square tilted 45 degrees), so that for a surface it would be::</span>

<span class="sd">                        h^{2,2}</span>
<span class="sd">                h^{2,1}         h^{1,2}</span>
<span class="sd">        h^{2,0}         h^{1,1}         h^{0,2}</span>
<span class="sd">                h^{1,0}         h^{0,1}</span>
<span class="sd">                        h^{0,0}</span>

<span class="sd">One of their famous applications is the mirror symmetry prediction that every</span>
<span class="sd">Calabi-Yau 3-fold has a mirror Calabi-Yau threefold, which should imply that</span>
<span class="sd">their Hodge diamonds are transpositions. The first instance of this is the</span>
<span class="sd">quintic 3-fold and its mirror, whose Hodge diamonds are::</span>

<span class="sd">                    1</span>
<span class="sd">               0         0</span>
<span class="sd">          0         1         0</span>
<span class="sd">      1       101       101       1</span>
<span class="sd">          0         1         0</span>
<span class="sd">               0         0</span>
<span class="sd">                    1</span>

<span class="sd">and::</span>

<span class="sd">                   1</span>
<span class="sd">              0         0</span>
<span class="sd">          0       101       0</span>
<span class="sd">      1       1         1       1</span>
<span class="sd">          0       101       0</span>
<span class="sd">              0         0</span>
<span class="sd">                   1</span>


<span class="sd">The following are some very basic examples of operations and constructions one</span>
<span class="sd">can use within the Hodge diamond cutter. To get started we do::</span>

<span class="sd">    sage: load("diamond.py")</span>

<span class="sd">after starting Sage.</span>

<span class="sd">Pretty print the Hodge diamond of a genus 2 curve::</span>

<span class="sd">    sage: X = HodgeDiamond.from_matrix([[1, 2], [2, 1]])</span>
<span class="sd">    sage: print(X)</span>
<span class="sd">          1</span>
<span class="sd">      2       2</span>
<span class="sd">          1</span>

<span class="sd">Compute the Euler characteristic of the product of `X` with itself::</span>

<span class="sd">    sage: print((X*X).euler())</span>
<span class="sd">    4</span>

<span class="sd">Pretty print the Hodge diamond of the Hilbert square of a K3 surface::</span>

<span class="sd">    sage: S = HodgeDiamond.from_matrix([[1, 0, 1], [0, 20, 0], [1, 0, 1]])</span>
<span class="sd">    sage: print(hilbn(S, 2))</span>
<span class="sd">                        1</span>
<span class="sd">                   0         0</span>
<span class="sd">              1        21        1</span>
<span class="sd">          0        0         0        0</span>
<span class="sd">      1       21       232       21       1</span>
<span class="sd">          0        0         0        0</span>
<span class="sd">              1        21        1</span>
<span class="sd">                   0         0</span>
<span class="sd">                        1</span>

<span class="sd">There are many varieties built in, e.g. the previously defined K3 surface can</span>
<span class="sd">be compared to the built-in one::</span>

<span class="sd">    sage: print(S == K3())</span>
<span class="sd">    True</span>

<span class="sd">AUTHORS:</span>

<span class="sd">- Pieter Belmans (2019-01-27): initial version</span>
<span class="sd">- Pieter Belmans (2020-06-16): the version which got assigned a DOI</span>
<span class="sd">- Pieter Belmans (2021-08-04): various additions, added unit tests and proper documentation</span>

<span class="sd">"""</span>

<span class="c1"># ****************************************************************************</span>
<span class="c1">#       Copyright (C) 2021 Pieter Belmans &lt;pieterbelmans@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#                  https://www.gnu.org/licenses/</span>
<span class="c1"># ****************************************************************************</span>

<span class="kn">from</span> <span class="nn">sage.all</span> <span class="k">import</span> <span class="n">cartesian_product</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">prod</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="k">import</span> <span class="n">FunctionField</span><span class="p">,</span> <span class="n">LaurentPolynomialRing</span><span class="p">,</span> <span class="n">PolynomialRing</span><span class="p">,</span> <span class="n">PowerSeriesRing</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="k">import</span> <span class="n">QQ</span><span class="p">,</span> <span class="n">ZZ</span>

<div class="viewcode-block" id="HodgeDiamond"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond">[docs]</a><span class="k">class</span> <span class="nc">HodgeDiamond</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    This class implements some methods to work with Hodge diamonds.</span>
<span class="sd">    """</span>

    <span class="c1">#: polynomial ring used internally for the Hodge-Poincaré polynomial</span>
    <span class="c1">#: and can be used externally to create new polynomials (and thus diamonds)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">))</span>
    <span class="c1">#: variables in the polynomial ring for Hodge-Poincaré polynomials</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>

<div class="viewcode-block" id="HodgeDiamond.__init__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Constructor for a Hodge diamond if you know what you are doing</span>

<span class="sd">        This just uses the given matrix. It is probably advised to use the</span>
<span class="sd">        class methods</span>

<span class="sd">        * :meth:`HodgeDiamond.from_matrix`</span>
<span class="sd">        * :meth:`HodgeDiamond.from_polynomial`</span>

<span class="sd">        in most cases though.</span>
<span class="sd">        """</span>
        <span class="c1"># matrix representation of the Hodge diamond is used internally</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_m</span> <span class="o">=</span> <span class="n">m</span></div>

<div class="viewcode-block" id="HodgeDiamond.from_matrix"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.from_matrix">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_matrix</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Construct a Hodge diamond from a matrix</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``m`` -- square integer matrix representing a Hodge diamond</span>

<span class="sd">        - ``from_variety`` (default: False) -- whether a check should be</span>
<span class="sd">          performed that it comes from a variety</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Hodge diamond of a K3 surface::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: S = HodgeDiamond.from_matrix([[1, 0, 1], [0, 20, 0], [1, 0, 1]])</span>
<span class="sd">            sage: S == K3()</span>
<span class="sd">            True</span>

<span class="sd">        The following fails as the lack of symmetry prevents a geometric origin::</span>

<span class="sd">            sage: HodgeDiamond.from_matrix([[1, 2], [0, 1]], from_variety=True)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            AssertionError: The matrix does not</span>
<span class="sd">                            satisfy the conditions satisfied by the Hodge diamond of a</span>
<span class="sd">                            smooth projective variety.</span>

<span class="sd">        """</span>
        <span class="n">diamond</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">from_variety</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">diamond</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">(),</span> \
                <span class="sd">"""The matrix does not satisfy the conditions satisfied by the</span>
<span class="sd">                Hodge diamond of a smooth projective variety."""</span>

        <span class="c1"># get rid of trailing zeroes from the diamond</span>
        <span class="n">diamond</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">__to_matrix</span><span class="p">(</span><span class="n">diamond</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">diamond</span></div>


<div class="viewcode-block" id="HodgeDiamond.from_polynomial"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.from_polynomial">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_polynomial</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Construct a Hodge diamond from a Hodge--Poincaré polynomial</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``f`` -- an integer polynomial in the ring ``HodgeDiamond.R``</span>
<span class="sd">          representing the Hodge--Poincaré polynomial</span>

<span class="sd">        - ``from_variety`` (default: False) -- whether a check should be</span>
<span class="sd">          performed that it comes from a variety</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Hodge diamond of a K3 surface::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: (x, y) = (HodgeDiamond.x, HodgeDiamond.y)</span>
<span class="sd">            sage: S = HodgeDiamond.from_polynomial(1 + x**2 + 20*x*y + y**2 + x**2 * y**2)</span>
<span class="sd">            sage: S == K3()</span>
<span class="sd">            True</span>

<span class="sd">        The following fails as the lack of symmetry prevents a geometric origin::</span>

<span class="sd">            sage: HodgeDiamond.from_polynomial(1 + x, from_variety=True)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            AssertionError: The matrix does not</span>
<span class="sd">                            satisfy the conditions satisfied by the Hodge diamond of a</span>
<span class="sd">                            smooth projective variety.</span>

<span class="sd">        """</span>
        <span class="n">diamond</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__to_matrix</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">from_variety</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">diamond</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">(),</span> <span class="s2">"""The matrix does not</span>
<span class="s2">                satisfy the conditions satisfied by the Hodge diamond of a</span>
<span class="s2">                smooth projective variety."""</span>

        <span class="k">return</span> <span class="n">diamond</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">polynomial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""The Hodge--Poincaré polynomial describing the Hodge diamond</span>

<span class="sd">        :getter: returns the Hodge--Poincaré polynomial</span>
<span class="sd">        :setter: sets the Hodge diamond using a Hodge--Poincaré polynomial</span>
<span class="sd">        :type: element of :attr:`HodgeDiamond.R`</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The Hodge--Poincaré polynomial of a K3 surface::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: print(K3().polynomial)</span>
<span class="sd">            x^2*y^2 + x^2 + 20*x*y + y^2 + 1</span>

<span class="sd">        Modifying the Hodge diamond of the projective plane::</span>

<span class="sd">            sage: X = Pn(2)</span>
<span class="sd">            sage: X.polynomial = X.polynomial + X.x * X.y</span>
<span class="sd">            sage: print(X)</span>
<span class="sd">                      1</span>
<span class="sd">                  0       0</span>
<span class="sd">              0       2       0</span>
<span class="sd">                  0       0</span>
<span class="sd">                      1</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="n">j</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> \
                <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">nrows</span><span class="p">()),</span> \
                    <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">ncols</span><span class="p">())])])</span>


    <span class="nd">@polynomial</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">polynomial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Setter for the Hodge--Poincaré polynomial"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">__to_matrix</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""The matrix describing the Hodge diamond</span>

<span class="sd">        :getter: returns the matrix</span>
<span class="sd">        :setter: sets the Hodge diamond using a matrix</span>
<span class="sd">        :type: square matrix of integers</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m</span>


    <span class="nd">@matrix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Setter for the Hodge diamond as a matrix"""</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">base_ring</span><span class="p">()</span> <span class="o">==</span> <span class="n">ZZ</span><span class="p">,</span> <span class="s2">"Entries need to be integers"</span>
        <span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">is_square</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normalise</span><span class="p">()</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__to_matrix</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Convert Hodge--Poincaré polynomial to matrix representation"""</span>
        <span class="k">assert</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span>

        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># deal with the size of the diamond in this way because of the following example:</span>
            <span class="c1"># X = complete_intersection(5, 3)</span>
            <span class="c1"># X*X - hilbtwo(X)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">exponents</span><span class="p">()])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">)]):</span>
                <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="n">j</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>


    <span class="k">def</span> <span class="nf">__size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Internal method to determine the (relevant) size of the Hodge diamond"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">ncols</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>


    <span class="k">def</span> <span class="nf">__normalise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Internal method to get rid of trailing zeros"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_m</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">__to_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


<div class="viewcode-block" id="HodgeDiamond.__eq__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether two Hodge diamonds are equal</span>

<span class="sd">        This compares the Hodge polynomials, not the possibly oversized</span>
<span class="sd">        matrices describing the Hodge diamond.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        A quartic surface is a K3 surface::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: K3() == hypersurface(4, 2)</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span></div>


<div class="viewcode-block" id="HodgeDiamond.__ne__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__ne__">[docs]</a>    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether two Hodge diamonds are not equal</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The projective line is not a genus 2 curve::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1) != curve(2)</span>
<span class="sd">            True</span>

<span class="sd">        The point is not the Lefschetz class::</span>

<span class="sd">            sage: point() != lefschetz()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>


<div class="viewcode-block" id="HodgeDiamond.__add__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Add two Hodge diamonds together</span>

<span class="sd">        This corresponds to taking the disjoint union of varieties, or the</span>
<span class="sd">        direct sum of the Hodge structure.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Hodge diamond of the projective line is the sum of that of a point</span>
<span class="sd">        and the Lefschetz diamond::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1) == point() + lefschetz()</span>
<span class="sd">            True</span>

<span class="sd">        Adding zero doesn't do anything::</span>

<span class="sd">            sage: K3() + zero() == K3()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__radd__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__radd__">[docs]</a>    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Add two Hodge diamonds together</span>

<span class="sd">        This is used when sum()'ing for instance."""</span>
        <span class="c1"># to make sum() work as intended, which by default starts with 0</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__sub__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Subtract two Hodge diamonds</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Hodge diamond of the projective line is the sum of that of a point</span>
<span class="sd">        and the Lefschetz diamond, but now we check it the other way around::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1) - point() == lefschetz()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__mul__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Multiply two Hodge diamonds</span>

<span class="sd">        This corresponds to taking the product of two varieties.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The quadric surface is the product of two projective lines::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1) * Pn(1) == hypersurface(2, 2)</span>
<span class="sd">            True</span>

<span class="sd">        The product is commutative::</span>

<span class="sd">            sage: K3() * curve(5) == curve(5) * K3()</span>
<span class="sd">            True</span>

<span class="sd">        The point is the unit::</span>

<span class="sd">            sage: K3() * point() == point() * K3() == K3()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">HodgeDiamond</span><span class="p">):</span> <span class="c1"># in the rare case someone does X*3 instead of 3*X</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__rmul__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__rmul__">[docs]</a>    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Multiply a Hodge diamond with a factor</span>

<span class="sd">        This corresponds to iterated addition.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``factor`` -- coefficient for the iterated addition</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The disjoint union of 2 K3 surfaces in two ways:</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: 2*K3() == K3() + K3()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__pow__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__pow__">[docs]</a>    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Raise a Hodge diamond to a power</span>

<span class="sd">        This corresponds to iterated multiplication.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``power`` -- exponent for the iterated multiplication</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The product of 2 K3 surfaces in two ways::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: K3()**2 == K3()*K3()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">**</span> <span class="n">power</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__call__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        The calling operator either does a Lefschetz twist, or an evaluation</span>

<span class="sd">        If one parameter is present, then twist by a power of the Lefschetz</span>
<span class="sd">        Hodge diamond. If two parameters are present, then evaluate the</span>
<span class="sd">        Hodge-Poincaré polynomial</span>

<span class="sd">        Negative values are allowed to untwist, up to the appropriate power.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``i`` -- integer denoting the power of the Lefschetz class, or</span>
<span class="sd">          value for the first variable</span>

<span class="sd">        - ``y`` -- value of the second variable (default: ``None``), if it is</span>
<span class="sd">          non-zero then ``i`` is reinterpreted as the value of the first variable</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The Lefschetz class is by definition the twist of the point::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: lefschetz() == point()(1)</span>
<span class="sd">            True</span>

<span class="sd">        We can reconstruct projective space as a sum of twists of the point::</span>

<span class="sd">            sage: Pn(10) == sum([point()(i) for i in range(11)])</span>
<span class="sd">            True</span>

<span class="sd">        If we supply two parameters we are evaluation the Hodge-Poincare</span>
<span class="sd">        polynomial, e.g. to find the Euler characteristic::</span>

<span class="sd">            sage: Pn(10)(1, 1) == 11</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lefschetz_power</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.__getitem__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Get (p, q)th entry of Hodge diamond or the ith row of the Hodge diamond"""</span>
        <span class="c1"># first try it as (p, q)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">index</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># now we assume it's an integer</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># we could do something smarter, but this is it for now</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></div>


<div class="viewcode-block" id="HodgeDiamond.__repr__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Output diagnostic information</span>

<span class="sd">        This is a one-line string giving some basic information about the Hodge</span>
<span class="sd">        diamond. You'll see this when you just evaluate something which returns</span>
<span class="sd">        a Hodge diamond. To see something more useful, you'll likely want to use</span>

<span class="sd">        * :meth:`HodgeDiamond.__str__` via `print`</span>
<span class="sd">        * :meth:`HodgeDiamond.pprint`</span>
<span class="sd">        * :meth:`HodgeDiamond.polynomial`</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The projective line::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1)</span>
<span class="sd">            Hodge diamond of size 2 and dimension 1</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="s2">"Hodge diamond of size </span><span class="si">{}</span><span class="s2"> and dimension </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">())</span></div>


<div class="viewcode-block" id="HodgeDiamond.__str__"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Pretty print Hodge diamond</span>

<span class="sd">        This gets called when you specifically print the object.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The projective line::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: print(Pn(1))</span>
<span class="sd">                  1</span>
<span class="sd">              0       0</span>
<span class="sd">                  1</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pprint</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="nf">__table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Generate a table object for the Hodge diamond"""</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span>
        <span class="n">T</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
            <span class="n">T</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">d</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">],</span> <span class="s2">""</span><span class="p">])</span>

                <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># padding all rows to full length</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">""</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">table</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">"center"</span><span class="p">)</span>


<div class="viewcode-block" id="HodgeDiamond.pprint"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.pprint">[docs]</a>    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Pretty print the Hodge diamond</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``format`` -- output format (default: `"table"`), if table it pretty prints</span>
<span class="sd">            a Hodge diamond; all else defaults to the polynomial</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The projective line::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(1).pprint()</span>
<span class="sd">                  1</span>
<span class="sd">              0       0</span>
<span class="sd">                  1</span>
<span class="sd">            sage: Pn(1).pprint(format="polynomial")</span>
<span class="sd">            x*y + 1</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"table"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__table</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span></div>


    <span class="k">def</span> <span class="nf">__is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether all entries are positive integers"""</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">hpq</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">hpq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()])</span>


<div class="viewcode-block" id="HodgeDiamond.is_hodge_symmetric"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.is_hodge_symmetric">[docs]</a>    <span class="k">def</span> <span class="nf">is_hodge_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether the Hodge diamond satisfies Hodge symmetry</span>

<span class="sd">        This checks the equality</span>

<span class="sd">        .. MATH::</span>

<span class="sd">            \mathrm{h}^{p,q}(X)=\mathrm{h}^{q,p}(X)</span>

<span class="sd">        for $p,q=0,\\ldots,\\dim X$.</span>

<span class="sd">        Almost all of the constructions provided with the library satisfy Hodge</span>
<span class="sd">        symmetry, because we (somewhat implicitly) work with things which are</span>
<span class="sd">        (or behave like) smooth projective varieties over a field of</span>
<span class="sd">        characteristic zero.</span>

<span class="sd">        Over the complex numbers this can fail for non-Kähler manifolds, such</span>
<span class="sd">        as the Hopf surface.</span>

<span class="sd">        In positive characteristic this can fail too, with an example given by</span>
<span class="sd">        classical and singular Enriques surfaces in characteristic 2, see [MR0491720]</span>
<span class="sd">        and Proposition 1.4.2 in [MR0986969]</span>

<span class="sd">        * [MR0491720] Bombieri--Mumford, Enriques' classification of surfaces in char. p. III.</span>
<span class="sd">        * [MR0986969] Cossec--Dolgachev, Enriques surfaces I, Progress in Mathematics, 1989</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Constructions satisfy this property::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(5).is_hodge_symmetric()</span>
<span class="sd">            True</span>

<span class="sd">        The Hopf surface over the complex numbers::</span>

<span class="sd">            sage: S = HodgeDiamond.from_matrix([[1, 0, 0], [1, 0, 1], [0, 0, 1]])</span>
<span class="sd">            sage: print(S)</span>
<span class="sd">                      1</span>
<span class="sd">                  0       1</span>
<span class="sd">              0       0       0</span>
<span class="sd">                  1       0</span>
<span class="sd">                      1</span>
<span class="sd">            sage: S.is_hodge_symmetric()</span>
<span class="sd">            False</span>

<span class="sd">        Classical and singular Enriques surfaces in characteristic 2</span>
<span class="sd">        (which are smooth, despite their name) also have a Hodge diamond</span>
<span class="sd">        violating Hodge symmetry::</span>

<span class="sd">            sage: enriques(two="classical").is_hodge_symmetric()</span>
<span class="sd">            False</span>
<span class="sd">            sage: enriques(two="singular").is_hodge_symmetric()</span>
<span class="sd">            False</span>
<span class="sd">            sage: enriques(two="supersingular").is_hodge_symmetric()</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">()</span></div>


<div class="viewcode-block" id="HodgeDiamond.is_serre_symmetric"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.is_serre_symmetric">[docs]</a>    <span class="k">def</span> <span class="nf">is_serre_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether the Hodge diamond satisfies Serre symmetry</span>

<span class="sd">        This checks the equality</span>

<span class="sd">        .. MATH::</span>

<span class="sd">            \mathrm{h}^{p,q}(X)=\mathrm{h}^{\dim X-p,\dim X-q}(X)</span>

<span class="sd">        for $p,q=0,\\ldots,\\dim X$.</span>

<span class="sd">        Because Serre duality holds for all smooth projective varieties,</span>
<span class="sd">        independent of the characteristic, and also for non-Kähler varieties</span>
<span class="sd">        there are no examples where this condition fails. It can of course fail</span>
<span class="sd">        for motivic pieces, for silly reasons.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The Hilbert scheme of 4 points on a K3 surface satisfies the symmetry::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: hilbn(K3(), 4).is_serre_symmetric()</span>
<span class="sd">            True</span>

<span class="sd">        The Lefschetz diamond fails it for silly reasons::</span>

<span class="sd">            sage: lefschetz().is_serre_symmetric()</span>
<span class="sd">            False</span>

<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])])</span></div>


<div class="viewcode-block" id="HodgeDiamond.betti"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.betti">[docs]</a>    <span class="k">def</span> <span class="nf">betti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Betti numbers of the Hodge diamond</span>

<span class="sd">        This gives an integer vector.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        Betti numbers of a K3 surface::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: K3().betti()</span>
<span class="sd">            [1, 0, 22, 0, 1]</span>

<span class="sd">        The second Betti number of the Hilbert scheme of points on a K3 surface</span>
<span class="sd">        is 23, not 22::</span>

<span class="sd">            sage: [hilbn(K3(), n).betti()[2] for n in range(2, 5)]</span>
<span class="sd">            [23, 23, 23]</span>

<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">d</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></div>


<div class="viewcode-block" id="HodgeDiamond.middle"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.middle">[docs]</a>    <span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Middle cohomology of the Hodge diamond</span>

<span class="sd">        For smooth projective varieties the middle cohomology sits in degree</span>
<span class="sd">        equal to the dimension.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        There is an interesting link between K3 surfaces and cubic fourfolds</span>
<span class="sd">        which can be seen on the level of middle cohomology::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: (hypersurface(3, 4) - lefschetz()**2).middle()</span>
<span class="sd">            [0, 1, 20, 1, 0]</span>
<span class="sd">            sage: K3().middle()</span>
<span class="sd">            [1, 20, 1]</span>

<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></div>


<div class="viewcode-block" id="HodgeDiamond.euler"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.euler">[docs]</a>    <span class="k">def</span> <span class="nf">euler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""The topological Euler characteristic of the Hodge diamond</span>

<span class="sd">        This is the alternating sum of the Betti numbers, so that</span>

<span class="sd">        .. MATH::</span>

<span class="sd">            \chi_{\mathrm{top}}=\sum_{p,q=0}^{\dim X}(-1)^{p+q}\mathrm{h}^{p,q}</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The Euler characteristic of projective space grows linearly::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: [Pn(n).euler() for n in range(10)]</span>
<span class="sd">            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>

<span class="sd">        For Hilbert schemes of points of K3 surfaces these are the</span>
<span class="sd">        coefficients of the series expansion of the Dedekind eta-function,</span>
<span class="sd">        see A006922 in the OEIS::</span>

<span class="sd">            sage: [hilbn(K3(), n).euler() for n in range(5)]</span>
<span class="sd">            [1, 24, 324, 3200, 25650]</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">bi</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">betti</span><span class="p">())])</span></div>


<div class="viewcode-block" id="HodgeDiamond.holomorphic_euler"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.holomorphic_euler">[docs]</a>    <span class="k">def</span> <span class="nf">holomorphic_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Holomorphic Euler characteristic</span>

<span class="sd">        This is the Euler characteristic of the structure sheaf, so</span>

<span class="sd">        .. MATH::</span>

<span class="sd">            \chi(X)=\sum_{i=0}^{\dim X}(-1)^i\mathrm{h}^{0,i}(X)</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        For projective space it is 1::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: all([Pn(n).holomorphic_euler() == 1 for n in range(10)])</span>
<span class="sd">            True</span>

<span class="sd">        For a hyperkähler variety of dimension $2n$ this number is $n+1$::</span>

<span class="sd">            sage: all([K3n(n).holomorphic_euler() == n+1 for n in range(5)])</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">nrows</span><span class="p">())])</span></div>


<div class="viewcode-block" id="HodgeDiamond.hirzebruch"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.hirzebruch">[docs]</a>    <span class="k">def</span> <span class="nf">hirzebruch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Hirzebruch's \chi_y genus</span>

<span class="sd">        For a smooth projective variety $X$ Hirzebruch's $\\chi_y$-genus is</span>
<span class="sd">        defined as</span>

<span class="sd">        .. MATH::</span>

<span class="sd">            \chi_y(X)=\sum_{p,q=0}^{\dim X}(-1)^{p+q}\mathrm{h}^{p,q}(X)y^p</span>

<span class="sd">        which shows it is the specialisation of the Hodge-Poincaré polynomial</span>
<span class="sd">        for $x=-1$. A further specialisation to $y=-1$ gives the Euler characteristic.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        For a K3 surface we have::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: K3().hirzebruch()</span>
<span class="sd">            2*y^2 - 20*y + 2</span>
<span class="sd">            sage: K3().hirzebruch().subs(y=-1) == K3().euler()</span>
<span class="sd">            True</span>

<span class="sd">        For the Hilbert square of a K3 surface we get::</span>

<span class="sd">            sage: hilbn(K3(), 2).hirzebruch()</span>
<span class="sd">            3*y^4 - 42*y^3 + 234*y^2 - 42*y + 3</span>
<span class="sd">            sage: hilbn(K3(), 2).hirzebruch().subs(y=-1) == hilbn(K3(), 2).euler()</span>
<span class="sd">            True</span>


<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.homological_unit"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.homological_unit">[docs]</a>    <span class="k">def</span> <span class="nf">homological_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Dimensions of $\\mathrm{H}^\bullet(X,O_X)$</span>

<span class="sd">        A notion intorduced by Abuaf.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="HodgeDiamond.hochschild"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.hochschild">[docs]</a>    <span class="k">def</span> <span class="nf">hochschild</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Dimensions of the Hochschild homology</span>

<span class="sd">        Columns of the Hodge diamond are Hochschild homology, by the Hochschild-</span>
<span class="sd">        Kostant-Rosenberg theorem.</span>
<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">d</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span></div>


<div class="viewcode-block" id="HodgeDiamond.hh"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.hh">[docs]</a>    <span class="k">def</span> <span class="nf">hh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Shorthand for :meth:`HodgeDiamond.hochschild`"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hochschild</span><span class="p">()</span></div>


<div class="viewcode-block" id="HodgeDiamond.arises_from_variety"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.arises_from_variety">[docs]</a>    <span class="k">def</span> <span class="nf">arises_from_variety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether the Hodge diamond can arise from a smooth projective variety</span>

<span class="sd">        The constraints are:</span>

<span class="sd">        - satisfy Hodge symmetry</span>
<span class="sd">        - satisfy Serre symmetry</span>
<span class="sd">        - there is no Lefschetz twist</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_hodge_symmetric</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_serre_symmetric</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lefschetz_power</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="HodgeDiamond.is_zero"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.is_zero">[docs]</a>    <span class="k">def</span> <span class="nf">is_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Check whether the Hodge diamond is identically zero"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">is_zero</span><span class="p">()</span></div>


<div class="viewcode-block" id="HodgeDiamond.lefschetz_power"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.lefschetz_power">[docs]</a>    <span class="k">def</span> <span class="nf">lefschetz_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Return the twist by the Lefschetz motive that is present</span>

<span class="sd">        In other words, we see how divisible the Hodge--Poincaré polynomial is</span>
<span class="sd">        with respect to the monomial $x^iy^i$"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span> <span class="k">return</span> <span class="mi">0</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">divides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="HodgeDiamond.dimension"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.dimension">[docs]</a>    <span class="k">def</span> <span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Dimension of the Hodge diamond</span>

<span class="sd">        This takes twists by the Lefschetz class into account: we untwist by</span>
<span class="sd">        the maximal power and ony then determine how big the diamond is.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        A point is 0-dimensional::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: point().dimension()</span>
<span class="sd">            0</span>

<span class="sd">        The Lefschetz diamond is also 0-dimensional::</span>

<span class="sd">            sage: print(lefschetz())</span>
<span class="sd">                  0</span>
<span class="sd">              0       0</span>
<span class="sd">                  1</span>
<span class="sd">            sage: lefschetz().dimension()</span>
<span class="sd">            0</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_hodge_symmetric</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">ncols</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">is_zero</span><span class="p">()])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lefschetz_power</span><span class="p">()</span></div>


<div class="viewcode-block" id="HodgeDiamond.level"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.level">[docs]</a>    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Compute the level (or complexity) of the Hodge diamond</span>

<span class="sd">        This is a measure of the width of the non-zero part of the Hodge diamond.</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The simplest case is projective space, with level zero::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: all([Pn(n).level() == 0 for n in range(10)])</span>
<span class="sd">            True</span>

<span class="sd">        For intersections of 2 quadrics it alternates between zero and one::</span>

<span class="sd">            sage: all([complete_intersection([2,2], 2*n).level() == 0 for n in range(5)])</span>
<span class="sd">            True</span>
<span class="sd">            sage: all([complete_intersection([2,2], 2*n+1).level() == 1 for n in range(5)])</span>
<span class="sd">            True</span>

<span class="sd">        A Calabi-Yau variety (e.g. a hypersurface of degree $n+1$ in $\\mathbb{P}^n$) has maximal level::</span>

<span class="sd">            sage: all([hypersurface(n+2, n).level() == n for n in range(10)])</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">degrees</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">()]])</span></div>


<div class="viewcode-block" id="HodgeDiamond.blowup"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.blowup">[docs]</a>    <span class="k">def</span> <span class="nf">blowup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">codim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Compute Hodge diamond of blowup</span>

<span class="sd">        No consistency checks are performed, this just naively applies the blowup</span>
<span class="sd">        formula from Hodge theory.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``other`` -- Hodge diamond of the center of the blowup</span>

<span class="sd">        - ``codim`` -- codimension of the center (optional), in case it is not</span>
<span class="sd">            the Hodge diamond of an honest variety</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        A cubic surface is the blowup of $\\mathbb{P}^2$ in 6 points::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: Pn(2).blowup(6*point()) == hypersurface(3, 2)</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="c1"># let's guess the codimension</span>
        <span class="k">if</span> <span class="n">codim</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">codim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">other</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">codim</span><span class="p">)])</span></div>


<div class="viewcode-block" id="HodgeDiamond.bundle"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.bundle">[docs]</a>    <span class="k">def</span> <span class="nf">bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Compute the Hodge diamond of a projective bundle</span>

<span class="sd">        This applies the bundle formula from Hodge theory without any consistency checks.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``rank``: rank of the vector bundle on ``self``</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        A projective bundle on a point is a projective space::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: point().bundle(3) == Pn(2)</span>
<span class="sd">            True</span>

<span class="sd">        A quadric surface is a $\\mathbb{P}^1$-bundle on $\\mathbb{P}^1$::</span>

<span class="sd">            sage: Pn(1).bundle(2) == hypersurface(2, 2)</span>
<span class="sd">            True</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rank</span><span class="p">)])</span></div>

<div class="viewcode-block" id="HodgeDiamond.mirror"><a class="viewcode-back" href="../index.html#diamond.HodgeDiamond.mirror">[docs]</a>    <span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Compute the mirror Hodge diamond</span>

<span class="sd">        EXAMPLES:</span>

<span class="sd">        The mirror to a quintic 3-fold is the following::</span>

<span class="sd">            sage: load("diamond.py")</span>
<span class="sd">            sage: print(hypersurface(5, 3).mirror())</span>
<span class="sd">                             1</span>
<span class="sd">                        0         0</span>
<span class="sd">                    0       101       0</span>
<span class="sd">                1       1         1       1</span>
<span class="sd">                    0       101       0</span>
<span class="sd">                        0         0</span>
<span class="sd">                             1</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">exponents</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">exponents</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">()]))</span></div></div>



<div class="viewcode-block" id="HochschildHomology"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology">[docs]</a><span class="k">class</span> <span class="nc">HochschildHomology</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    This class implements some methods to work with (the dimensions of)</span>
<span class="sd">    Hochschild homology spaces, associated to the :class:`HodgeDiamond` class.</span>

<span class="sd">    The documentation is not intended to be complete, as this is mostly for my own sake.</span>
<span class="sd">    """</span>

    <span class="c1"># exposes R and t for external use</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">LaurentPolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Constructor for Hochschild homology dimensions of smooth and proper dg categories, so that Serre duality holds.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``L`` -- a list of integers of length 2n+1 representing $\\mathrm{HH}_{-n}$ to $\\mathrm{HH}_n$, such that ``L[i] == L[2n - i]``</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"length needs to be odd, to reflect Serre duality"</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">L</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">))]),</span> <span class="s2">"Serre duality is not satisfied"</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">L</span>


<div class="viewcode-block" id="HochschildHomology.from_list"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.from_list">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Constructor for Hochschild homology dimensions from a list.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``L`` -- a list of integers representing $\\mathrm{HH}_{-n}$ to $\\mathrm{HH}_n$</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">L</span><span class="p">)</span></div>


<div class="viewcode-block" id="HochschildHomology.from_positive"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.from_positive">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_positive</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Constructor for Hochschild homology dimensions from a list when only the positive part is given.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``L`` -- a list of integers representing $\\mathrm{HH}_0$ to $\\mathrm{HH}_n$</span>
<span class="sd">        """</span>
        <span class="n">double</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></div>


<div class="viewcode-block" id="HochschildHomology.from_polynomial"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.from_polynomial">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_polynomial</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Constructor for Hochschild homology dimensions from Hochschild--Poincaré Laurent polynomial</span>

<span class="sd">        INPUT</span>

<span class="sd">        - ``f`` -- the Hochschild--Poincaré Laurent polynomial</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span> <span class="k">return</span> <span class="bp">cls</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">dict</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">exponents</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">L</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">polynomial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]))</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"Hochschild homology vector of dimension </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pprint</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">__table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">table</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">header_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">table</span><span class="p">([</span><span class="n">indices</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]],</span> <span class="n">header_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="HochschildHomology.pprint"><a class="viewcode-back" href="../docs/diamond/source/index.html#diamond.HochschildHomology.pprint">[docs]</a>    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">"table"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s2">"table"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__table</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span></div>


<div class="viewcode-block" id="HochschildHomology.dimension"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.dimension">[docs]</a>    <span class="k">def</span> <span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Largest index ``i`` such that $\\mathrm{HH}_i\\neq 0$"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="HochschildHomology.is_zero"><a class="viewcode-back" href="../docs/diamond/source/index.html#diamond.HochschildHomology.is_zero">[docs]</a>    <span class="k">def</span> <span class="nf">is_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="HochschildHomology.euler"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.euler">[docs]</a>    <span class="k">def</span> <span class="nf">euler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Euler characteristic of Hochschild homology"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># to make sum() work as intended, which by default starts with 0</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">HochschildHomology</span><span class="p">):</span> <span class="c1"># in the rare case someone does X*3 instead of 3*X</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">polynomial</span>


    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>


    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>


<div class="viewcode-block" id="HochschildHomology.symmetric_power"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.symmetric_power">[docs]</a>    <span class="k">def</span> <span class="nf">symmetric_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">        Hochschild homology of the Ganter--Kapranov symmetric power of a smooth and proper dg category</span>

<span class="sd">        This is possibly only a heuristic (I didn't check for proofs in the literature) based on the decomposition of Hochschild homology for a quotient stack, as discussed in the paper of Polishchuk--Van den Bergh</span>
<span class="sd">        """</span>
        <span class="k">def</span> <span class="nf">summand</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">[</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()]</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">t</span>

            <span class="c1"># trivial case</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">number_of_terms</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span>
            <span class="c1"># base case</span>
            <span class="k">elif</span> <span class="n">f</span><span class="o">.</span><span class="n">number_of_terms</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">exponents</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">binomial</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">binomial</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
            <span class="c1"># general case</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># splitting f into monomial and the difference</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exponents</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">g</span>

                <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">summand</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">summand</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="c1"># see the object C^{(\lambda)} in the Polishchuk--Van den Bergh paper</span>
        <span class="k">return</span> <span class="n">HochschildHomology</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">product</span><span class="p">([</span><span class="n">summand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">ri</span><span class="p">)</span> <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">to_exp</span><span class="p">()])</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="n">k</span><span class="p">)]))</span></div>


<div class="viewcode-block" id="HochschildHomology.sym"><a class="viewcode-back" href="../index.html#diamond.HochschildHomology.sym">[docs]</a>    <span class="k">def</span> <span class="nf">sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">"""Shorthand for ```HochschildHomology.symmetric_power```"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_power</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="zero"><a class="viewcode-back" href="../index.html#diamond.zero">[docs]</a><span class="k">def</span> <span class="nf">zero</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">"""Hodge diamond for the empty space</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    Zero::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(zero())</span>
<span class="sd">          0</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="point"><a class="viewcode-back" href="../index.html#diamond.point">[docs]</a><span class="k">def</span> <span class="nf">point</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">"""Hodge diamond for the point</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The point::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(point())</span>
<span class="sd">          1</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="lefschetz"><a class="viewcode-back" href="../index.html#diamond.lefschetz">[docs]</a><span class="k">def</span> <span class="nf">lefschetz</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">"""Hodge diamond for the Lefschetz motive</span>

<span class="sd">    This is the Hodge-Poincaré polynomial of the affine line.</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The affine line::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(lefschetz())</span>
<span class="sd">              0</span>
<span class="sd">          0       0</span>
<span class="sd">              1</span>

<span class="sd">    We can take powers of it, to get the Hodge-Poincaré polynomial for higher-</span>
<span class="sd">    dimensional affine spaces::</span>

<span class="sd">        sage: print(lefschetz()**3)</span>
<span class="sd">                      0</span>
<span class="sd">                  0       0</span>
<span class="sd">              0       0       0</span>
<span class="sd">          0       0       0       0</span>
<span class="sd">              0       0       0</span>
<span class="sd">                  0       0</span>
<span class="sd">                      1</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">point</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="Pn"><a class="viewcode-back" href="../index.html#diamond.Pn">[docs]</a><span class="k">def</span> <span class="nf">Pn</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for projective space of dimension $n$</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``n``: dimension, non-negative integer</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The zero-dimensional case is a point::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: Pn(0) == point()</span>
<span class="sd">        True</span>

<span class="sd">    In general projective space is the sum of powers of the Lefschetz class::</span>

<span class="sd">        sage: all([Pn(n) == sum([lefschetz()**i for i in range(n + 1)]) for n in range(1, 10)])</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> \
            <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="curve"><a class="viewcode-back" href="../index.html#diamond.curve">[docs]</a><span class="k">def</span> <span class="nf">curve</span><span class="p">(</span><span class="n">genus</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for a curve of a given genus.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus``: the genus of the curve, non-negative integer</span>

<span class="sd">    EXAMPLE:</span>

<span class="sd">    A curve of genus 0 is the 1-dimensional projective space::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: curve(0) == Pn(1)</span>
<span class="sd">        True</span>

<span class="sd">    A curve of genus 1 is an abelian variety of dimension 1::</span>

<span class="sd">        sage: curve(1) == abelian(1)</span>
<span class="sd">        True</span>

<span class="sd">    A curve of genus 2::</span>

<span class="sd">        sage: print(curve(2))</span>
<span class="sd">              1</span>
<span class="sd">          2       2</span>
<span class="sd">              1</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">genus</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">genus</span><span class="p">],</span> <span class="p">[</span><span class="n">genus</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> \
            <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="surface"><a class="viewcode-back" href="../index.html#diamond.surface">[docs]</a><span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="n">genus</span><span class="p">,</span> <span class="n">irregularity</span><span class="p">,</span> <span class="n">h11</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for a surface $S$ with given invariants</span>

<span class="sd">    These invariants are the geometric genus, the irregularity and the middle</span>
<span class="sd">    Hodge numbers ``h11``.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus`` -- geometric genus of the surface, $\\dim\\mathrm{H}^2(S,\\mathcal{O}_S)$,</span>
<span class="sd">        a non-negative integer</span>

<span class="sd">    - ``irregularity`` -- irregularity of the surface, $\\dim\\mathrm{H}^1(S,\\mathcal{O}_S)$,</span>
<span class="sd">        a non-negative integer</span>

<span class="sd">    - ``h11`` -- middle Hodge number, $\\dim\\mathrm{H}^1(S,\\Omega_S^1)$,</span>
<span class="sd">        a non-negative integer</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The projective plane::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: Pn(2) == surface(0, 0, 1)</span>
<span class="sd">        True</span>

<span class="sd">    A K3 surface::</span>

<span class="sd">        sage: K3() == surface(1, 0, 20)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">genus</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">irregularity</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">h11</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="n">pg</span> <span class="o">=</span> <span class="n">genus</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">irregularity</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">pg</span><span class="p">],</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">h11</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> <span class="p">[</span><span class="n">pg</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> \
            <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="symmetric_power"><a class="viewcode-back" href="../index.html#diamond.symmetric_power">[docs]</a><span class="k">def</span> <span class="nf">symmetric_power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">genus</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the nth symmetric power of a curve of given genus</span>

<span class="sd">    For the proof, see Example 1.1(1) of [MR2777820]. An earlier reference, probably in Macdonald, should exist.</span>

<span class="sd">    * [MR2777820] Laurentiu--Schuermann, Hirzebruch invariants of symmetric products. Topology of algebraic varieties and singularities, 163–177, Contemp. Math., 538, Amer. Math. Soc., 2011.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``n`` -- exponent of the symmetric power</span>

<span class="sd">    - ``genus`` -- genus of the curve, a non-negative integer</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The symmetric square of a genus 3 curve::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(symmetric_power(2, 3))</span>
<span class="sd">                  1</span>
<span class="sd">              3        3</span>
<span class="sd">          3       10       3</span>
<span class="sd">              3        3</span>
<span class="sd">                  1</span>

<span class="sd">    If $n=1$ we get the curve back::</span>

<span class="sd">        sage: all([symmetric_power(1, g) == curve(g) for g in range(10)])</span>
<span class="sd">        True</span>

<span class="sd">    If $n=0$ we get the point::</span>

<span class="sd">        sage: symmetric_power(0, 4) == point()</span>
<span class="sd">        True</span>

<span class="sd">    If $n&lt;0$ we have the empty space::</span>

<span class="sd">        sage: symmetric_power(-1, 4) == zero()</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">hpq</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">binomial</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">binomial</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">q</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hpq</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hpq</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">zero</span><span class="p">()</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpq</span><span class="p">(</span><span class="n">genus</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="jacobian"><a class="viewcode-back" href="../index.html#diamond.jacobian">[docs]</a><span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="n">genus</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Jacobian of a genus $g$ curve</span>

<span class="sd">    This is an abelian variety of dimension `genus`, so we call :func:`abelian`</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus`` -- genus of the curve</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The Jacobian of a genus 3 curve::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(jacobian(3))</span>
<span class="sd">                      1</span>
<span class="sd">                  3       3</span>
<span class="sd">              3       9       3</span>
<span class="sd">          1       9       9       1</span>
<span class="sd">              3       9       3</span>
<span class="sd">                  3       3</span>
<span class="sd">                      1</span>

<span class="sd">    For the projective line we get a point::</span>

<span class="sd">        sage: jacobian(0) == point()</span>
<span class="sd">        True</span>

<span class="sd">    The Jacobian of an elliptic curve is isomorphic to it::</span>

<span class="sd">        sage: jacobian(1) == curve(1)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">abelian</span><span class="p">(</span><span class="n">genus</span><span class="p">)</span></div>


<div class="viewcode-block" id="abelian"><a class="viewcode-back" href="../index.html#diamond.abelian">[docs]</a><span class="k">def</span> <span class="nf">abelian</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for an abelian variety of a given dimension.</span>

<span class="sd">    This description is standard, and follows from the fact that the cohomology</span>
<span class="sd">    is the exterior power of the first cohomology, as graded algebra.</span>

<span class="sd">    See e.g. Proposition 7.27 in the Edixhoven--van der Geer--Moonen book-in-progress</span>
<span class="sd">    on abelian varieties.</span>
<span class="sd">    """</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">binomial</span><span class="p">(</span><span class="n">dimension</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">binomial</span><span class="p">(</span><span class="n">dimension</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="kummer_resolution"><a class="viewcode-back" href="../index.html#diamond.kummer_resolution">[docs]</a><span class="k">def</span> <span class="nf">kummer_resolution</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for the standard resolution of the Kummer variety of an abelian variety of a given dimension.</span>

<span class="sd">    There's an invariant part (Hodge numbers of even degree) and the resolution of the 2^2g singularities is added.</span>
<span class="sd">    """</span>
    <span class="n">invariant</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">jacobian</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">invariant</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">point</span><span class="p">()(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="p">)])</span></div>


<div class="viewcode-block" id="moduli_vector_bundles"><a class="viewcode-back" href="../index.html#diamond.moduli_vector_bundles">[docs]</a><span class="k">def</span> <span class="nf">moduli_vector_bundles</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">genus</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the moduli space of vector bundles of given rank and</span>
<span class="sd">    fixed determinant of given degree on a curve of a given genus.</span>

<span class="sd">    For the proof, see Corollary 5.1 of [MR1817504].</span>

<span class="sd">    * [MR1817504] del Baño, On the Chow motive of some moduli spaces. J. Reine Angew. Math. 532 (2001), 105–132.</span>

<span class="sd">    If the Hodge diamond for the moduli space with non-fixed determinant of</span>
<span class="sd">    degree `d` is required, this can be obtained by::</span>

<span class="sd">        jacobian(g) * moduli_vector_bundles(r, d, g)</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - `rank` -- rank of the bundles, at least 2</span>

<span class="sd">    - `degree` -- degree of the fixed determinant, coprime to rank</span>

<span class="sd">    - `genus` -- genus of the curve, at least 2</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The case of rank 2, degree 1 and genus 2 is famously the intersection of</span>
<span class="sd">    2 quadrics in $\\mathbb{P}^5$::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: moduli_vector_bundles(2, 1, 2) == complete_intersection([2, 2], 3)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rank</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">degree</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">genus</span>

    <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"rank needs to be at least 2"</span>
    <span class="k">assert</span> <span class="n">g</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"genus needs to be at least 2"</span>
    <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"rank and degree need to be coprime"</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span> <span class="nf">bracket</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">"""Return the decimal part of a fraction."""</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">floor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">one</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">"""Return the first factor in del Bano's formula."""</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="n">g</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># already corrected the factor from the Jacobian</span>

    <span class="k">def</span> <span class="nf">two</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">"""Return the second factor in del Bano's formula."""</span>
        <span class="k">return</span> <span class="n">prod</span><span class="p">([</span><span class="n">prod</span><span class="p">([(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">g</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">])])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))])</span>

    <span class="k">def</span> <span class="nf">three</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">"""Return the third factor in del Bano's formula."""</span>
        <span class="k">return</span> <span class="n">prod</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">four</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">"""Return the fourth factor in del Bano's formula."""</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">sum</span><span class="p">([(</span><span class="n">g</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">)])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">bracket</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="n">C</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="n">exponent</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">one</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">two</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">three</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">four</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">Compositions</span><span class="p">(</span><span class="n">r</span><span class="p">)])),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="seshadris_desingularisation"><a class="viewcode-back" href="../index.html#diamond.seshadris_desingularisation">[docs]</a><span class="k">def</span> <span class="nf">seshadris_desingularisation</span><span class="p">(</span><span class="n">genus</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for Seshadri's desingularisation of the moduli space of</span>
<span class="sd">    rank 2 bundles with trivial determinant on a curve of a given genus $g$.</span>

<span class="sd">    For the statement, see Corollary 3.18 of [MR1895918].</span>

<span class="sd">    * [MR1895918] del Baño, On the motive of moduli spaces of rank two vector bundles over a curve. Compositio Math. 131 (2002), 1-30.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus`` -- the genus $g$, at least 2</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    For $g=2$ nothing needs to be desingularised, and the answer is $\\mathbb{P}^3$::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: seshadris_desingularisation(2) == Pn(3)</span>
<span class="sd">        True</span>

<span class="sd">    Already for $g=3$ the result is not a familiar variety, so we just check the</span>
<span class="sd">    Euler characteristic::</span>

<span class="sd">        sage: seshadris_desingularisation(3).euler() == 112</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">genus</span>

    <span class="k">assert</span> <span class="n">g</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"genus needs to be at least 2"</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">one</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="n">g</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="n">g</span> <span class="o">*</span> <span class="n">A</span><span class="o">**</span><span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">two</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">**</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span><span class="o">**</span><span class="n">g</span> <span class="o">+</span> <span class="n">B</span><span class="o">**</span><span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># fixed typo in del Bano: compare to 3.12, motive of P^(g-2)</span>
    <span class="n">three</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">**</span><span class="n">g</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">four</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">**</span><span class="n">g</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># fixed typo in del Bano: compare to 3.14, power of L at the end</span>
    <span class="n">five</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">two</span> <span class="o">+</span> <span class="n">three</span> <span class="o">+</span> <span class="n">four</span> <span class="o">+</span> <span class="n">five</span><span class="p">))</span></div>


<div class="viewcode-block" id="moduli_parabolic_vector_bundles_rank_two"><a class="viewcode-back" href="../index.html#diamond.moduli_parabolic_vector_bundles_rank_two">[docs]</a><span class="k">def</span> <span class="nf">moduli_parabolic_vector_bundles_rank_two</span><span class="p">(</span><span class="n">genus</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the moduli space of parabolic rank 2 bundles with</span>
<span class="sd">    fixed determinant of odd degree on a curve of genus $g$.</span>

<span class="sd">    See Corollary 5.34 of [2011.14872].</span>

<span class="sd">    * [2011.14872] Fu--Hoskins--Pepin Lehalleur, Motives of moduli spaces of</span>
<span class="sd">      bundles on curves via variation of stability and flips</span>

<span class="sd">    This is not a proof of the formula we implemented per se, but it should be correct.</span>
<span class="sd">    Also, it could be that the choice of weights give something singular / stacky. Then it'll</span>
<span class="sd">    give bad output without warning. You have been warned.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus`` -- the genus of the curve</span>

<span class="sd">    - ``alpha`` -- the weights of the parabolic bundles</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">I</span> <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">Subsets</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">I</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">I</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">binomial</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">floor</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">genus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="n">zero</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">genus</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="n">curve</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">genus</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="n">moduli_vector_bundles</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">genus</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">genus</span><span class="p">)(</span><span class="n">genus</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)])</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="fano_variety_intersection_quadrics_odd"><a class="viewcode-back" href="../index.html#diamond.fano_variety_intersection_quadrics_odd">[docs]</a><span class="k">def</span> <span class="nf">fano_variety_intersection_quadrics_odd</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Fano variety of $g-i$-planes on the intersection of</span>
<span class="sd">    two quadrics in $\\mathbb{P}^{2g+1}$, using [MR3689749].</span>

<span class="sd">    We have that for i = 2 we get M_C(2,L) as above, for deg L odd.</span>

<span class="sd">    * [MR3689749] Chen--Vilonen--Xue, On the cohomology of Fano varieties and the Springer correspondence, Adv. Math. 318 (2017), 515–533.</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    For $i=2$ we recover the moduli space of rank 2 bundles with odd determinant</span>
<span class="sd">    on a curve of genus $g$::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: fano_variety_intersection_quadrics_odd(5, 2) == moduli_vector_bundles(2, 1, 5)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="c1"># some random high bound which works in many cases</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">PowerSeriesRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">default_prec</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span><span class="p">))</span> <span class="o">*</span> <span class="n">prod</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span> <span class="o">/</span> <span class="n">prod</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="n">polynomial</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">N</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">symmetric_power</span><span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="n">symmetric_power</span><span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">g</span><span class="p">)(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">middle</span><span class="p">()</span>
            <span class="n">exterior</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">dimensions</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">polynomial</span> <span class="o">=</span> <span class="n">polynomial</span> <span class="o">+</span> <span class="n">N</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">exterior</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">binomial</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="n">g</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="n">exterior</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># checking the Betti numbers</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="fano_variety_intersection_quadrics_even"><a class="viewcode-back" href="../index.html#diamond.fano_variety_intersection_quadrics_even">[docs]</a><span class="k">def</span> <span class="nf">fano_variety_intersection_quadrics_even</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Fano variety of $i-1$-planes on the intersection of</span>
<span class="sd">    two quadrics in $\\mathbb{P}^{2g}$, using [1510.05986v3].</span>

<span class="sd">    * [1510.05986v3] Chen--Vilonen--Xue, Springer correspondence, hyperelliptic curves, and cohomology of Fano varieties</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``g`` -- half of the dimension of the ambient projective space</span>

<span class="sd">    - ``i`` -- affine dimension of the linear subspaces on the intersection of quadrics</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    We have that for i = g-1 we get the moduli space of parabolic bundles on</span>
<span class="sd">    $\\mathbb{P}^1$ with weight $1/2$ in $2g+3$ points::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: moduli_parabolic_vector_bundles_rank_two(0, [1/2]*5) == fano_variety_intersection_quadrics_even(2, 1)</span>
<span class="sd">        True</span>
<span class="sd">        sage: moduli_parabolic_vector_bundles_rank_two(0, [1/2]*7) == fano_variety_intersection_quadrics_even(3, 2)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">grassmannian</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)[</span><span class="n">k</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">i</span><span class="p">),</span> <span class="n">k</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">i</span><span class="p">)]</span>

    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="n">polynomial</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">polynomial</span> <span class="o">=</span> <span class="n">polynomial</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">M</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">binomial</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">k</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="quot_scheme_curve"><a class="viewcode-back" href="../index.html#diamond.quot_scheme_curve">[docs]</a><span class="k">def</span> <span class="nf">quot_scheme_curve</span><span class="p">(</span><span class="n">genus</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Quot scheme of zero-dimensional quotients of given</span>
<span class="sd">    length of a vector bundle of given rank on a curve of given genus.</span>

<span class="sd">    For the proof, see Proposition 4.5 of [1907.00826] (or rather, the</span>
<span class="sd">    reference [Bif89] in there)</span>

<span class="sd">    * [1907.00826] Bagnarol--Fantechi--Perroni, On the motive of zero-dimensional Quot schemes on a curve</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">dn</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
        <span class="c1"># shift in indexing because we start at 0</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">ni</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ni</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">P</span><span class="p">)])</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">product</span><span class="p">([</span><span class="n">symmetric_power</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">genus</span><span class="p">)</span> <span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="n">P</span><span class="p">])(</span><span class="n">dn</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">IntegerVectors</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">rank</span><span class="p">)])</span></div>


<div class="viewcode-block" id="hilbtwo"><a class="viewcode-back" href="../docs/diamond/source/index.html#diamond.hilbtwo">[docs]</a><span class="k">def</span> <span class="nf">hilbtwo</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Hilbert square of any smooth projective variety</span>

<span class="sd">    For the proof, see e.g. lemma 2.6 of [MR2506383], or the corollary on page 507 of [MR1382733] (but it can be said to be classical).</span>

<span class="sd">    * [MR2506383] Muñoz--Ortega--Vázquez-Gallo, Hodge polynomials of the moduli spaces of triples of rank (2,2). Q. J. Math. 60 (2009), no. 2, 235–272.</span>
<span class="sd">    * [MR1382733] Cheah, On the cohomology of Hilbert schemes of points, J. Algebraic Geom. 5 (1996), no. 3, 479-511</span>

<span class="sd">    INPUT:</span>

<span class="sd">    -  ``X`` - Hodge diamond of the smooth projective variety</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    We recover the Hilbert square of a surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: hilbtwo(K3()) == hilbn(K3(), 2)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">polynomial</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="hilbthree"><a class="viewcode-back" href="../docs/diamond/source/index.html#diamond.hilbthree">[docs]</a><span class="k">def</span> <span class="nf">hilbthree</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond of the Hilbert cube of any smooth projective variety</span>

<span class="sd">    The corollary on page 507 of [MR1382733].</span>

<span class="sd">    * [MR1382733] Cheah, On the cohomology of Hilbert schemes of points, J. Algebraic Geom. 5 (1996), no. 3, 479-511</span>

<span class="sd">    INPUT:</span>

<span class="sd">    -  ``X`` - Hodge diamond of the smooth projective variety</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    We recover the Hilbert cube of a surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: hilbthree(K3()) == hilbn(K3(), 3)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">R</span><span class="p">(</span>
        <span class="mi">1</span><span class="o">/</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">polynomial</span>
        <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">polynomial</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">+</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">polynomial</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">)])</span>
        <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">X</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">polynomial</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">)])</span>
        <span class="p">),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="K3n"><a class="viewcode-back" href="../index.html#diamond.K3n">[docs]</a><span class="k">def</span> <span class="nf">K3n</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the Hilbert scheme of $n$ points on a K3 surface</span>

<span class="sd">    This is the first family of hyperkähler varieties, constructed by Beauville.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``n`` -- number of points</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    For $n=1$ we have a K3 surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: K3n(1) == K3()</span>
<span class="sd">        True</span>

<span class="sd">    For $n\\geq 2$ we have second Betti number 23::</span>

<span class="sd">        sage: all([K3n(n).betti()[2] == 23 for n in range(2, 5)])</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">hilbn</span><span class="p">(</span><span class="n">K3</span><span class="p">(),</span> <span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="generalised_kummer"><a class="viewcode-back" href="../index.html#diamond.generalised_kummer">[docs]</a><span class="k">def</span> <span class="nf">generalised_kummer</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the $n$th generalised Kummer variety</span>

<span class="sd">    For the proof, see Corollary 1 of [MR1219901].</span>

<span class="sd">    * [MR1219901] Göttsche--Soergel, Perverse sheaves and the cohomology of Hilbert schemes of smooth algebraic surfaces. Math. Ann. 296 (1993), no. 2, 235–245.</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The first generalised Kummer is just a point::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: generalised_kummer(1) == point()</span>
<span class="sd">        True</span>

<span class="sd">    The second generalised Kummer is the Kummer K3 surface::</span>

<span class="sd">        sage: generalised_kummer(2) == K3()</span>
<span class="sd">        True</span>

<span class="sd">    The higher generalised Kummers are hyperkähler varieties with second Betti number 7::</span>

<span class="sd">        sage: all([generalised_kummer(n).betti()[2] == 7 for n in range(3, 10)])</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span>

        <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">gcd</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">*</span> <span class="n">prod</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">prod</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span><span class="p">((</span><span class="n">j</span><span class="o">**</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="n">j</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">to_exp_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">to_exp_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="n">n</span><span class="p">)]])(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">))</span>

    <span class="c1"># Göttsche--Soergel gives the polynomial for A\times Kum^n A, so we quotient out A</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">product</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ogrady6"><a class="viewcode-back" href="../index.html#diamond.ogrady6">[docs]</a><span class="k">def</span> <span class="nf">ogrady6</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for O'Grady's exceptional 6-dimensional hyperkähler variety</span>

<span class="sd">    For the proof, see Theorem 1.1 of [MR3798592].</span>

<span class="sd">    * [MR3798592] Mongardi--Rapagnetta--Saccà, The Hodge diamond of O'Grady's six-dimensional example. Compos. Math. 154 (2018), no. 5, 984–1013.</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The second Betti number is 8::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: ogrady6().betti()[2] == 8</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span>
        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1144</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ogrady10"><a class="viewcode-back" href="../index.html#diamond.ogrady10">[docs]</a><span class="k">def</span> <span class="nf">ogrady10</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for O'Grady's exceptional 10-dimensional hyperkähler variety</span>

<span class="sd">    For the proof, see theorem A of [1905.03217]</span>

<span class="sd">    * [1905.03217] de Cataldo--Rapagnetta--Saccà, The Hodge numbers of O'Grady 10 via Ngô strings</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The second Betti number is 24::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: ogrady10().betti()[2] == 24</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span>
        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2531</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16490</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16490</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2531</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">88024</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2531</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16490</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16490</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2531</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="hilbn"><a class="viewcode-back" href="../index.html#diamond.hilbn">[docs]</a><span class="k">def</span> <span class="nf">hilbn</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for Hilbert scheme of ``n`` points on a smooth projective surface ``S``</span>

<span class="sd">    For the proof, see Theorem 2.3.14 of [MR1312161].</span>

<span class="sd">    * [MR1312161] Göttsche, Hilbert schemes of zero-dimensional subschemes of smooth varieties. Lecture Notes in Mathematics, 1572. Springer-Verlag, Berlin, 1994. x+196 pp.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``S`` -- Hodge diamond for smooth projective surface</span>

<span class="sd">    - ``n`` -- number of points</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">surface</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">surface</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">PowerSeriesRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">),</span> <span class="n">default_prec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># theorem 2.3.14 of Göttsche's book</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]):</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">surface</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">])</span>

    <span class="c1"># read off Hodge diamond from the (truncated) series</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]):</span>
        <span class="n">monomial</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="nb">min</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="n">n</span> <span class="c1"># use Serre duality</span>
        <span class="k">if</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">coefficients</span><span class="p">():</span>
            <span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="n">monomial</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="nestedhilbn"><a class="viewcode-back" href="../index.html#diamond.nestedhilbn">[docs]</a><span class="k">def</span> <span class="nf">nestedhilbn</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for the nested Hilbert scheme ``S^{[n-1,n]}``</span>

<span class="sd">    This is the unique nested Hilbert scheme of a smooth projective surface ``S``</span>
<span class="sd">    which is itself smooth (of dimension $2n$)</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">surface</span><span class="o">.</span><span class="n">arises_from_variety</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">surface</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">PowerSeriesRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">default_prec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># TODO lower this?</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>

    <span class="n">series</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">):</span> <span class="c1"># TODO lower this?</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">surface</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">surface</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>

    <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">*</span> <span class="n">R</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">polynomial</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># read off Hodge diamond from the (truncated) series</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cartesian_product</span><span class="p">([</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]):</span>
        <span class="n">monomial</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="nb">min</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">n</span> <span class="c1"># use Serre duality</span>
        <span class="k">if</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">coefficients</span><span class="p">():</span>
            <span class="n">M</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="n">monomial</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="complete_intersection"><a class="viewcode-back" href="../index.html#diamond.complete_intersection">[docs]</a><span class="k">def</span> <span class="nf">complete_intersection</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">dimension</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for a complete intersection of multidegree $(d_1,\\ldots,d_k)$ in $\\mathbb{P}^{n+k}$</span>

<span class="sd">    For a proof, see théorème 2.3 of exposé XI in SGA7.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``degrees`` -- the multidegree, if it is an integer we interpret it as a hypersurface</span>

<span class="sd">    - ``dimension`` -- the dimension of the complete intersection (not of the ambient space)</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    For multidegrees $(1,\\ldots,1) we get a lower-dimension projective space::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: complete_intersection(1, 2) == Pn(2)</span>
<span class="sd">        True</span>
<span class="sd">        sage: complete_intersection([1, 1], 2) == Pn(2)</span>
<span class="sd">        True</span>
<span class="sd">        sage: complete_intersection([1, 1], 5) == Pn(5)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="c1"># hypersurface as complete intersection</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span><span class="n">degrees</span><span class="p">]</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">PowerSeriesRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">),</span> <span class="n">default_prec</span><span class="o">=</span><span class="n">dimension</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>
    <span class="n">H</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">prod</span><span class="p">([((</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">di</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">di</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">di</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

    <span class="n">middle</span> <span class="o">=</span> <span class="p">[</span><span class="n">H</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="n">a</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">dimension</span><span class="o">-</span><span class="n">i</span><span class="p">)]</span> <span class="k">if</span> <span class="n">a</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">dimension</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">H</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="hypersurface"><a class="viewcode-back" href="../index.html#diamond.hypersurface">[docs]</a><span class="k">def</span> <span class="nf">hypersurface</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">dimension</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""Shorthand for a complete intersection of the given dimension where $k=1$"""</span>
    <span class="k">return</span> <span class="n">complete_intersection</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">dimension</span><span class="p">)</span></div>


<div class="viewcode-block" id="K3"><a class="viewcode-back" href="../index.html#diamond.K3">[docs]</a><span class="k">def</span> <span class="nf">K3</span><span class="p">():</span>
    <span class="sd">"""Hodge diamond for a K3 surface</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The K3 surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(K3())</span>
<span class="sd">                  1</span>
<span class="sd">              0        0</span>
<span class="sd">          1       20       1</span>
<span class="sd">              0        0</span>
<span class="sd">                  1</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">complete_intersection</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="enriques"><a class="viewcode-back" href="../index.html#diamond.enriques">[docs]</a><span class="k">def</span> <span class="nf">enriques</span><span class="p">(</span><span class="n">two</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""Hodge diamond for an Enriques surface</span>

<span class="sd">    It is possible to ask for the Hodge diamond of a classical or (super)singular</span>
<span class="sd">    Enriques surface in characteristic 2.</span>

<span class="sd">    In characteristic 2 the invariants are given in Proposition 1.4.2 of [MR0986969].</span>

<span class="sd">    * [MR0986969] Cossec--Dolgachev, Enriques surfaces I, Progress in Mathematics, 1989</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``two`` -- optional parameter to indicate the type of surface in characteristic 2</span>
<span class="sd">        possible values are `"classical"`, `"singular"`, `"supersingular"`</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    An ordinary Enriques surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(enriques())</span>
<span class="sd">                  1</span>
<span class="sd">              0        0</span>
<span class="sd">          0       10       0</span>
<span class="sd">              0        0</span>
<span class="sd">                  1</span>

<span class="sd">    Enriques surfaces in characteristic 2::</span>

<span class="sd">        sage: print(enriques(two="classical"))</span>
<span class="sd">                  1</span>
<span class="sd">              0        1</span>
<span class="sd">          0       12       0</span>
<span class="sd">              1        0</span>
<span class="sd">                  1</span>
<span class="sd">        sage: print(enriques(two="singular"))</span>
<span class="sd">                  1</span>
<span class="sd">              1        0</span>
<span class="sd">          1       10       1</span>
<span class="sd">              0        1</span>
<span class="sd">                  1</span>
<span class="sd">        sage: print(enriques(two="supersingular"))</span>
<span class="sd">                  1</span>
<span class="sd">              1        1</span>
<span class="sd">          1       12       1</span>
<span class="sd">              1        1</span>
<span class="sd">                  1</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">two</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">two</span> <span class="o">==</span> <span class="s2">"classical"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">two</span> <span class="o">==</span> <span class="s2">"singular"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">two</span> <span class="o">==</span> <span class="s2">"supersingular"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"invalid choice for characteristic 2"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">surface</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></div>


<div class="viewcode-block" id="ruled"><a class="viewcode-back" href="../index.html#diamond.ruled">[docs]</a><span class="k">def</span> <span class="nf">ruled</span><span class="p">(</span><span class="n">genus</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""Hodge diamond for a ruled surface</span>

<span class="sd">    These are $\\mathbb{P}^1$-bundles over a curve of given genus.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``genus`` -- genus of the base curve</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    For genus 0 we get Hirzebruch surfaces, whose Hodge diamond is that of</span>
<span class="sd">    the quadric surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: ruled(0) == hypersurface(2, 2)</span>
<span class="sd">        True</span>

<span class="sd">    For higher genus the Hodge diamond looks as follows::</span>

<span class="sd">        sage: print(ruled(5))</span>
<span class="sd">                  1</span>
<span class="sd">              5       5</span>
<span class="sd">          0       2       0</span>
<span class="sd">              5       5</span>
<span class="sd">                  1</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">surface</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">genus</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="weighted_hypersurface"><a class="viewcode-back" href="../index.html#diamond.weighted_hypersurface">[docs]</a><span class="k">def</span> <span class="nf">weighted_hypersurface</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Hodge diamond for a weighted hypersurface of degree ``d`` in ``P(w_0,...,w_n)``</span>

<span class="sd">    Implementation taken from</span>
<span class="sd">    https://github.com/jxxcarlson/math_research/blob/master/hodge.sage.</span>
<span class="sd">    If I'm not mistaken, the generalisation to weighted complete intersection</span>
<span class="sd">    depends on which polynomials are used, not just the degrees, even if the</span>
<span class="sd">    result is smooth?</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``degree`` -- degree of the hypersurface</span>

<span class="sd">    - ``weights`` -- the weights of the weighted projective space, if it is an</span>
<span class="sd">      integer we interpret it as the dimension of P^n</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    Elliptic curves can be realised as hypersurfaces in 3 ways::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: weighted_hypersurface(3, 2) == weighted_hypersurface(3, [1, 1, 1])</span>
<span class="sd">        True</span>
<span class="sd">        sage: weighted_hypersurface(3, 2) == curve(1)</span>
<span class="sd">        True</span>
<span class="sd">        sage: weighted_hypersurface(4, [1, 1, 2]) == curve(1)</span>
<span class="sd">        True</span>
<span class="sd">        sage: weighted_hypersurface(6, [1, 2, 3]) == curve(1)</span>
<span class="sd">        True</span>

<span class="sd">    The Fano 3-fold 1.1 is a weighted hypersurface::</span>

<span class="sd">        sage: fano_threefold(1, 1) == weighted_hypersurface(6, [1,1,1,1,3])</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">var</span><span class="p">(</span><span class="s1">'t'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">poincare_function</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expand</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">simplify</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">jacobian_weights</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">degree</span> <span class="o">-</span> <span class="n">weight</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">poincare</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">poincare_function</span><span class="p">(</span><span class="n">jacobian_weights</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>


    <span class="c1"># weights should be interpreted as dimension of unweighted P^n</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="n">sage</span><span class="o">.</span><span class="n">rings</span><span class="o">.</span><span class="n">integer</span><span class="o">.</span><span class="n">Integer</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">weights</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">poincare</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">vdeg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tdeg</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degree</span> <span class="o">-</span> <span class="n">vdeg</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">taylor</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tdeg</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">middle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">degree</span> <span class="o">-</span> <span class="n">vdeg</span><span class="p">))</span>

    <span class="c1"># adding in non-primitive cohomology if necessary</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">middle</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="cyclic_cover"><a class="viewcode-back" href="../index.html#diamond.cyclic_cover">[docs]</a><span class="k">def</span> <span class="nf">cyclic_cover</span><span class="p">(</span><span class="n">ramification_degree</span><span class="p">,</span> <span class="n">cover_degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of a cyclic cover of weighted projective space</span>

<span class="sd">    Implementation taken from</span>
<span class="sd">    https://github.com/jxxcarlson/math_research/blob/master/hodge.sage.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``ramification_degree`` -- degree of the ramification divisor</span>

<span class="sd">    - ``cover_degree`` -- size of the cover</span>

<span class="sd">    - ``weights`` -- the weights of the weighted projective space, if it is an</span>
<span class="sd">      integer we interpret it as the dimension of ``P^n``</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    Some K3 surfaces are double covers of $\\mathbb{P}^2$ in a sextic curve::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: cyclic_cover(6, 2, 2) == K3()</span>
<span class="sd">        True</span>

<span class="sd">    The Fano 3-fold 1.1 is a double cover of $\\mathbb{P}^3$ in a sextic::</span>

<span class="sd">        sage: cyclic_cover(6, 2, 3) == fano_threefold(1, 1)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="c1"># weights should be interpreted as dimension of unweighted P^n</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="n">sage</span><span class="o">.</span><span class="n">rings</span><span class="o">.</span><span class="n">integer</span><span class="o">.</span><span class="n">Integer</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">weights</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ramification_degree</span> <span class="o">//</span> <span class="n">cover_degree</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weighted_hypersurface</span><span class="p">(</span><span class="n">ramification_degree</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></div>


<div class="viewcode-block" id="partial_flag_variety"><a class="viewcode-back" href="../index.html#diamond.partial_flag_variety">[docs]</a><span class="k">def</span> <span class="nf">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of a partial flag variety G/P</span>

<span class="sd">    This is computed by counting the number of Schubert cells in the</span>
<span class="sd">    appropriate dimension.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``D`` -- Dynkin type</span>

<span class="sd">    - ``I`` -- indices of vertices to be omitted in defining the parabolic</span>
<span class="sd">      subgroup</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    An absolute baby case is projective space::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: partial_flag_variety("A5", [2,3,4,5]) == Pn(5)</span>
<span class="sd">        True</span>

<span class="sd">    The next easiest case are quadrics::</span>

<span class="sd">        sage: partial_flag_variety("B5", [2,3,4,5]) == hypersurface(2, 9)</span>
<span class="sd">        True</span>
<span class="sd">        sage: partial_flag_variety("D5", [2,3,4,5]) == hypersurface(2, 8)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">DynkinDiagram</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

    <span class="n">WG</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">root_system</span><span class="p">()</span><span class="o">.</span><span class="n">root_lattice</span><span class="p">()</span><span class="o">.</span><span class="n">weyl_group</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">prod</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">WG</span><span class="o">.</span><span class="n">degrees</span><span class="p">()])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WL</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">subtype</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">root_system</span><span class="p">()</span><span class="o">.</span><span class="n">root_lattice</span><span class="p">()</span><span class="o">.</span><span class="n">weyl_group</span><span class="p">()</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">prod</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">WL</span><span class="o">.</span><span class="n">degrees</span><span class="p">()])</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">diagonal_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">P</span><span class="o">/</span><span class="n">Q</span><span class="p">)</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()),</span>
                                    <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="generalised_grassmannian"><a class="viewcode-back" href="../index.html#diamond.generalised_grassmannian">[docs]</a><span class="k">def</span> <span class="nf">generalised_grassmannian</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the generalised Grassmannian of type D modulo the maximal parabolic subgroup $P_k$.</span>

<span class="sd">    This is just shorthand for :func:`partial_flag_variety(D, I)` where ``I`` is the complement of a singleton.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``D`` -- Dynkin type</span>

<span class="sd">    - ``k`` -- the vertex in the Dynkin diagram defining the maximal parabolic</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="grassmannian"><a class="viewcode-back" href="../index.html#diamond.grassmannian">[docs]</a><span class="k">def</span> <span class="nf">grassmannian</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the Grassmannian $\\operatorname{Gr}(k,n)$ of $k$-dimensional subspaces in</span>
<span class="sd">    an $n$-dimensional vector space</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``k`` -- dimension of the subspaces</span>

<span class="sd">    - ``n`` -- dimension of the ambient vector space</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span> <span class="k">return</span> <span class="n">point</span><span class="p">()</span>

    <span class="n">D</span> <span class="o">=</span> <span class="s2">"A"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span></div>


<div class="viewcode-block" id="orthogonal_grassmannian"><a class="viewcode-back" href="../index.html#diamond.orthogonal_grassmannian">[docs]</a><span class="k">def</span> <span class="nf">orthogonal_grassmannian</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the orthogonal Grassmannian $\\operatorname{OGr}(k, n)$ of $k$-dimensional</span>
<span class="sd">    subspaces in an $n$-dimensional vector space isotropic with respect to a</span>
<span class="sd">    non-degenerate symmetric bilinear form</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``k`` -- dimension of the subspaces</span>

<span class="sd">    - ``n`` -- dimension of the ambient vector space</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="s2">"D"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># exceptional case: need submaximal parabolic</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="s2">"B"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span></div>


<div class="viewcode-block" id="symplectic_grassmannian"><a class="viewcode-back" href="../index.html#diamond.symplectic_grassmannian">[docs]</a><span class="k">def</span> <span class="nf">symplectic_grassmannian</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the symplectic Grassmannian $\\operatorname{SGr}(k, n)$ of $k$-dimensional</span>
<span class="sd">    subspaces in an $n$-dimensional vector space isotropic with respect to a</span>
<span class="sd">    non-degenerate skew-symmetric bilinear form</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``k`` -- dimension of the subspaces</span>

<span class="sd">    - ``n`` -- dimension of the ambient vector space</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="n">D</span> <span class="o">=</span> <span class="s2">"C"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">partial_flag_variety</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span></div>


<div class="viewcode-block" id="lagrangian_grassmannian"><a class="viewcode-back" href="../index.html#diamond.lagrangian_grassmannian">[docs]</a><span class="k">def</span> <span class="nf">lagrangian_grassmannian</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">"""Shorthand for the symplectic Grassmannian of Lagrangian subspaces"""</span>
    <span class="k">return</span> <span class="n">symplectic_grassmannian</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="horospherical"><a class="viewcode-back" href="../index.html#diamond.horospherical">[docs]</a><span class="k">def</span> <span class="nf">horospherical</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Horospherical varieties as discussed in [1803.05063], with labelling</span>
<span class="sd">    and notation as in op. cit.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``D``: either a Dynkin type from the (small) list of allowed types</span>
<span class="sd">             in the classification</span>
<span class="sd">             _or_ a plaintext label from X1(n), X2, X3(n,m), X4, X5</span>

<span class="sd">    - ``y``: index for the parabolic subgroup for Y, see classification</span>

<span class="sd">    - ``z``: index for the parabolic subgroup for the closed orbit Z</span>

<span class="sd">    ``y`` and ``z`` must be omitted if a plaintext description is given.</span>

<span class="sd">    * [1803.05063] Gonzales--Pech--Perrin--Samokhin, Geometry of horospherical</span>
<span class="sd">      varieties of Picard rank one</span>
<span class="sd">    """</span>
    <span class="c1"># treat D as the plaintext description of a horospherical variety</span>
    <span class="c1"># not supposed to be 100% robust</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">D</span> <span class="c1"># rename for less confusion</span>

        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"B"</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"B3"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"C"</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"F4"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"G2"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># didn't recognise it so far, so must be wrong</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="c1"># determine the Hodge diamond from the blowup description</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">generalised_grassmannian</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">generalised_grassmannian</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"B"</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dimension</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dimension</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"C"</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="s2">"F4"</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="mi">23</span>
    <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="s2">"G2"</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="n">codimXY</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">-</span> <span class="n">Y</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>
    <span class="n">codimXZ</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">-</span> <span class="n">Z</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Y</span><span class="o">.</span><span class="n">bundle</span><span class="p">(</span><span class="n">codimXY</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Z</span> <span class="o">-</span> <span class="n">Z</span><span class="o">.</span><span class="n">bundle</span><span class="p">(</span><span class="n">codimXZ</span><span class="p">)</span></div>


<div class="viewcode-block" id="odd_symplectic_grassmannian"><a class="viewcode-back" href="../index.html#diamond.odd_symplectic_grassmannian">[docs]</a><span class="k">def</span> <span class="nf">odd_symplectic_grassmannian</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of the odd symplectic Grassmannian $\\operatorname{SGr}(k,n)$</span>

<span class="sd">    Here $n$ is odd. This is just shorthand for a call to :func:`horospherical_variety`</span>
<span class="sd">    for type C, with parameters $\lfloor n/2\rlfloor$, and $Y$ and $Z$ determined</span>
<span class="sd">    by $k$ and $k - 1$.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">horospherical</span><span class="p">(</span><span class="s2">"C"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="gushel_mukai"><a class="viewcode-back" href="../index.html#diamond.gushel_mukai">[docs]</a><span class="k">def</span> <span class="nf">gushel_mukai</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for a smooth $n$-dimensional Gushel--Mukai variety</span>

<span class="sd">    See Proposition 3.1 of [1605.05648v3].</span>

<span class="sd">    * [1605.05648v3] Debarre--Kuznetsov, Gushel-Mukai varieties: linear spaces and periods</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``n`` - the dimension, where $n=1,\\ldots,6$</span>
<span class="sd">    """</span>

    <span class="k">assert</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="s2">"""There is no Gushel--Mukai variety of this</span>
<span class="s2">        dimension"""</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">curve</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K3</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">curve</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">0</span> <span class="o">+</span> <span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">4</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">curve</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pn</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">lefschetz</span><span class="p">()</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Pn</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span></div>


<div class="viewcode-block" id="fano_variety_lines_cubic"><a class="viewcode-back" href="../index.html#diamond.fano_variety_lines_cubic">[docs]</a><span class="k">def</span> <span class="nf">fano_variety_lines_cubic</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the Fano variety of lines on a smooth $n$-dimensional</span>
<span class="sd">    cubic hypersurface.</span>

<span class="sd">    This follows from the "beautiful formula" or X-F(X)-relation due to</span>
<span class="sd">    Galkin--Shinder, Theorem 5.1 of [1405.5154v2].</span>

<span class="sd">    * [1405.5154v2] Galkin--Shinder, The Fano variety of lines and rationality</span>
<span class="sd">      problem for a cubic hypersurface</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``n`` -- the dimension, where ``n`` is at least 2</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    There are 27 lines on a cubic surface::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: fano_variety_lines_cubic(2) == 27*point()</span>
<span class="sd">        True</span>

<span class="sd">    The Fano surface of lines on a cubic threefold is a surface of general type::</span>

<span class="sd">        sage: fano_variety_lines_cubic(3) == surface(10, 5, 25)</span>
<span class="sd">        True</span>

<span class="sd">    The Fano fourfold of lines on a cubic fourfold is deformation equivalent</span>
<span class="sd">    to the Hilbert square on a K3 surface::</span>

<span class="sd">        sage: fano_variety_lines_cubic(4) == hilbn(K3(), 2)</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">hypersurface</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">hilbtwo</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="p">)(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mzeronbar"><a class="viewcode-back" href="../index.html#diamond.Mzeronbar">[docs]</a><span class="k">def</span> <span class="nf">Mzeronbar</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the moduli space of $n$-pointed stable curves of genus 0</span>

<span class="sd">    Taken from (0.12) in [MR1363064]. Keel's original paper has a recursion</span>
<span class="sd">    on page 550, but that seems to not work.</span>

<span class="sd">    * [MR1363064] Manin, Generating functions in algebraic geometry and sums</span>
<span class="sd">      over trees</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The first few cases are a point, the projective line, and the blowup</span>
<span class="sd">    of $\\mathbb{P}^2$ in 4 points::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: Mzeronbar(3) == point()</span>
<span class="sd">        True</span>
<span class="sd">        sage: Mzeronbar(4) == Pn(1)</span>
<span class="sd">        True</span>
<span class="sd">        sage: Mzeronbar(5) == Pn(2).blowup(4*point())</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span> <span class="nf">Manin</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Manin</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">([</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Manin</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Manin</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">Manin</span><span class="p">(</span><span class="n">n</span><span class="p">))</span></div>


<span class="c1"># make Theta into slope stability</span>
<div class="viewcode-block" id="mu"><a class="viewcode-back" href="../docs/diamond/source/index.html#diamond.mu">[docs]</a><span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="n">Theta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""Helper function to turn stability for quiver representations in slope stability</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">d</span><span class="p">)])</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="quiver_moduli"><a class="viewcode-back" href="../index.html#diamond.quiver_moduli">[docs]</a><span class="k">def</span> <span class="nf">quiver_moduli</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond for the moduli space of semistable quiver representations</span>
<span class="sd">    for a quiver Q, dimension vector d, and slope-stability condition mu.</span>

<span class="sd">    Taken from Corollary 6.9 of [MR1974891]</span>

<span class="sd">    * [MR1974891] Reineke, The Harder-Narasimhan system in quantum groups and cohomology of quiver moduli.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``Q`` -- adjacency matrix of an acyclic quiver</span>

<span class="sd">    - ``d`` -- dimension vector</span>

<span class="sd">    - ``mu`` -- stability condition, these can be produced using :func:`mu`</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    Let's consider moduli spaces for the Kronecker quiver::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: def kronecker(d): return matrix([[0, d], [0, 0]])</span>

<span class="sd">    For the 2-Kronecker quiver and dimension vector `(1,1)` a representation</span>
<span class="sd">    is given by 2 scalars, and the stability condition `(1,-1)` encodes that</span>
<span class="sd">    they are not both zero. This way we obtain the projective line::</span>

<span class="sd">        sage: quiver_moduli(kronecker(2), (1, 1), mu((1, -1))) == Pn(1)</span>
<span class="sd">        True</span>

<span class="sd">    Similar to the first example, the $d$-Kronecker quiver gives rise to</span>
<span class="sd">    projective spaces::</span>

<span class="sd">        sage: all([quiver_moduli(kronecker(d), (1, 1), mu((1, -1))) == Pn(d - 1) for d in range(3, 10)])</span>
<span class="sd">        True</span>

<span class="sd">    We can also realise Grassmannians using the $d$-Kronecker quiver, for</span>
<span class="sd">    dimension vector $(1,k)$ and stability condition $(k,1)$ we get the</span>
<span class="sd">    Grassmannian $\\operatorname{Gr}(k,d)$::</span>

<span class="sd">        sage: quiver_moduli(kronecker(4), (1, 2), mu((2, 1))) == grassmannian(2, 4)</span>
<span class="sd">        True</span>
<span class="sd">        sage: quiver_moduli(kronecker(7), (1, 3), mu((3, 1))) == grassmannian(3, 7)</span>
<span class="sd">        True</span>

<span class="sd">    The flag variety $\\operatorname{Fl}(n,r_1,\\ldots,r_s)$ is also a quiver</span>
<span class="sd">    moduli space, for $\\mathrm{A}_s$ quiver prefixed with an $n$-Kronecker</span>
<span class="sd">    quiver, dimension vector $(1,r_1,\\ldots,r_s)$ with $r_1&gt;\\ldots&gt;r_s$</span>
<span class="sd">    and stability condition the indicator function at the first vertex::</span>

<span class="sd">        sage: def flags(n, s): return matrix(ZZ, s+1, s+1, lambda i,j: 0 if i != j-1 else (n if i == 0 else 1))</span>
<span class="sd">        sage: quiver_moduli(flags(4, 1), (1, 1), mu((1, 0))) == Pn(3)</span>
<span class="sd">        True</span>
<span class="sd">        sage: quiver_moduli(flags(3, 2), (1, 2, 1), mu((1, 0, 0))) == fano_threefold(2, 32)</span>
<span class="sd">        True</span>
<span class="sd">        sage: quiver_moduli(flags(5, 3), (1, 4, 3, 1), mu((1, 0, 0, 0))) == partial_flag_variety("A4", [2])</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">FunctionField</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="s1">'v'</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># we will use v, not v^2, throughout</span>

    <span class="c1"># solve Ax=b for A upper triangular via back substitution</span>
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">A</span><span class="o">.</span><span class="n">is_square</span><span class="p">()</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">nrows</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># start</span>
        <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">]</span>

        <span class="c1"># induct</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]))</span> <span class="o">/</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@cached_function</span>
    <span class="k">def</span> <span class="nf">GL</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">"""Cardinality of general linear group $\\mathrm{GL}_n(\\mathbb{F}_v)$"""</span>
        <span class="k">return</span> <span class="n">prod</span><span class="p">([</span><span class="n">v</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="n">v</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

    <span class="c1"># not caching this one seems faster</span>
    <span class="c1">#@cached_function</span>
    <span class="k">def</span> <span class="nf">Rd</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">"""Cardinality of ``R_d`` from Definition 3.1"""</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">**</span><span class="nb">sum</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">dict</span><span class="p">()])</span>

    <span class="nd">@cached_function</span>
    <span class="k">def</span> <span class="nf">Gd</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="sd">"""Cardinality of ``G_d`` from Definition 3.1"""</span>
        <span class="k">return</span> <span class="n">prod</span><span class="p">([</span><span class="n">GL</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">d</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">Id</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="sd">"""Returns the indexing set from Corollary 5.5</span>

<span class="sd">        These are the dimension vectors smaller than ``d`` whose slope is bigger</span>
<span class="sd">        than ``d``, together with the zero dimension vector and ``d`` itself.</span>
<span class="sd">        """</span>
        <span class="c1"># all possible dimension vectors e &lt;= d</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">cartesian_product</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">di</span><span class="p">:</span> <span class="n">di</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">))))</span>

        <span class="c1"># predicate from Corollary 5.5, E[0] is the zero dimension vector</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">mu</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mu</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">Td</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="sd">"""Returns the upper triangular transfer matrix from Corollary 5.5"""</span>
        <span class="c1"># Euler form</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">-</span> <span class="n">Q</span>
        <span class="c1"># indexing set for the transfer matrix</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="c1"># make them vectors now so that we only do it once</span>
        <span class="n">I</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">I</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">entry</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="sd">"""Entry of the transfer matrix, as per Corollary 6.9"""</span>
            <span class="n">fe</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">e</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">fei</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">fei</span> <span class="ow">in</span> <span class="n">fe</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">fe</span> <span class="o">*</span> <span class="n">chi</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rd</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span> <span class="o">/</span> <span class="n">Gd</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">T</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)):</span> <span class="c1"># upper triangular</span>
                <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">T</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="n">DiGraph</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
    <span class="c1"># see Section 2</span>
    <span class="k">assert</span> <span class="n">Q</span><span class="o">.</span><span class="n">is_directed_acyclic</span><span class="p">(),</span> <span class="s2">"Q needs to be acyclic"</span>

    <span class="c1"># see Definition 6.3 and following lemmas</span>
    <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"dimension vector is not coprime"</span>

    <span class="c1"># (0,d)-entry of the inverse of the transfer matrix, as per Corollary 6.9</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Td</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(),</span> <span class="n">d</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
    <span class="c1"># doing a back-substitution is faster</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">nrows</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
    <span class="c1">#result = T.inverse()[0,-1] * (1 - v)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"result needs to be a polynomial"</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">y</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">numerator</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_polynomial</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="fano_threefold"><a class="viewcode-back" href="../index.html#diamond.fano_threefold">[docs]</a><span class="k">def</span> <span class="nf">fano_threefold</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">ID</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    Hodge diamond of a Fano threefold</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``rho`` - Picard rank</span>

<span class="sd">    - ``ID`` - numbering from the Mori-Mukai classification</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    The 17th Fano 3-fold of rank 1 is projective threespace::</span>

<span class="sd">        sage: load("diamond.py")</span>
<span class="sd">        sage: print(fano_threefold(1, 17))</span>
<span class="sd">                      1</span>
<span class="sd">                  0       0</span>
<span class="sd">              0       1       0</span>
<span class="sd">          0       0       0       0</span>
<span class="sd">              0       1       0</span>
<span class="sd">                  0       0</span>
<span class="sd">                      1</span>

<span class="sd">    The 4th Fano 3-fold of rank 1 is an intersection of 3 quadrics::</span>

<span class="sd">        sage: fano_threefold(1, 4) == complete_intersection((2, 2, 2), 3)</span>
<span class="sd">        True</span>

<span class="sd">    The 27th Fano 3-fold of rank 3 is the triple product of projective lines::</span>

<span class="sd">        sage: fano_threefold(3, 27) == Pn(1)**3</span>
<span class="sd">        True</span>

<span class="sd">    """</span>
    <span class="n">h12</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">52</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">30</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">20</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">14</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">10</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">7</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span> <span class="mi">21</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span> <span class="mi">10</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">22</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">20</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">11</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">10</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">9</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mi">9</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">17</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">26</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">34</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">35</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">36</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">8</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">17</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">19</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">24</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">26</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">27</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
           <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">}</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">h12</span><span class="p">[(</span><span class="n">rho</span><span class="p">,</span> <span class="n">ID</span><span class="p">)],</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h12</span><span class="p">[(</span><span class="n">rho</span><span class="p">,</span> <span class="n">ID</span><span class="p">)],</span> <span class="n">rho</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">HodgeDiamond</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">from_variety</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</pre></div>
      </article>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Pieter Belmans
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensionsr": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"], "tex2jax": {"inlineMath": [["$", "$"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]]}})</script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>